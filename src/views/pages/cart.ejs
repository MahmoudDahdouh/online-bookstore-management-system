<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head'); %>

  <script>
    const localCart = JSON.parse(localStorage.getItem('cart')) || []

    const cart = localCart.reduce((acc, book) => {
      const found = acc.find((item) => item.id === book.id)
      if (found) {
        found.quantity++
      } else {
        acc.push({ ...book, quantity: 1 })
      }
      return acc
    }, [])
  </script>
  <body>
    <!--Nvabar-->
    <%- include('../partials/navbar')%>

    <!-- Main -->
    <main>
      <div class="container mt-5">
        <div class="d-flex align-items-center gap-4">
          <a href="/books" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>
            back
          </a>
          <h2 class="mb-0">Cart</h2>
        </div>
        <div class="table-responsive-md">
          <table class="table table-striped table-hover mt-2">
            <thead class="table-primary">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Description</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col"></th>
              </tr>
            </thead>

            <script>
              cart.map((book) => {
                document.write(`<tr>
                <th scope="row">${book.id}</th>
                <td>${book.title}</td>
                <td>${book.description}</td>
                <td>$${book.price}</td>
                <td>${book.quantity}</td>
                <td>
                  <button
                    class="btn-delete btn btn-danger btn-sm"
                    onclick="deleteBook('1')"
                  >
                    <i class="fas fa-trash me-2"></i>
                    delete
                  </button>
                </td>
              </tr>`)
              })
            </script>
          </table>
        </div>

        <div>
          <script>
            const total = localCart.reduce((acc, item) => acc + item.price, 0)
            document.write(
              `<h3 class='text-end mt-4 fs-1'>Total: $ ${total}</h3>`
            )
          </script>
        </div>
        <div class="d-flex justify-content-end">
          <a href="/checkout" class="btn btn-primary btn-lg">
            <i class="fas fa-shopping-cart me-2"></i>
            Checkout
          </a>
        </div>
      </div>
    </main>
    <!-- footer -->
    <%- include('../partials/footer'); %>
    <!-- Bootstrap JS files -->
    <script src="js/bootstrap.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
